(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{HMLe:function(e,t,n){"use strict";n.d(t,"a",function(){return A});var r=n("mrSG"),a=function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function o(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function i(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(s){a={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i}var s=function(e,t){var n,r,a,o,i,s;if(void 0===e)throw new Error("Pass options.removeUndefinedValues=true to remove undefined values from map/array/set.");if(null===e&&"object"==typeof e)return f();if(Array.isArray(e))return u(e,t);if("Set"===(null===(n=null==e?void 0:e.constructor)||void 0===n?void 0:n.name))return l(e,t);if("Map"===(null===(r=null==e?void 0:e.constructor)||void 0===r?void 0:r.name))return c(e,t);if("Object"===(null===(a=null==e?void 0:e.constructor)||void 0===a?void 0:a.name)||!e.constructor&&"object"==typeof e)return m(e,t);if(y(e))return 0===e.length&&(null==t?void 0:t.convertEmptyValues)?f():d(e);if("boolean"==typeof e||"Boolean"===(null===(o=null==e?void 0:e.constructor)||void 0===o?void 0:o.name))return{BOOL:e.valueOf()};if("number"==typeof e||"Number"===(null===(i=null==e?void 0:e.constructor)||void 0===i?void 0:i.name))return v(e);if("bigint"==typeof e)return p(e);if("string"==typeof e||"String"===(null===(s=null==e?void 0:e.constructor)||void 0===s?void 0:s.name))return 0===e.length&&(null==t?void 0:t.convertEmptyValues)?f():g(e);if((null==t?void 0:t.convertClassInstanceToMap)&&"object"==typeof e)return m(e,t);throw new Error("Unsupported type passed: "+e+". Pass options.convertClassInstanceToMap=true to marshall typeof object as map attribute.")},u=function(e,t){return{L:e.filter(function(e){return!(null==t?void 0:t.removeUndefinedValues)||(null==t?void 0:t.removeUndefinedValues)&&void 0!==e}).map(function(e){return s(e,t)})}},l=function(e,t){var n=(null==t?void 0:t.removeUndefinedValues)?new Set(function(e,t,n){if(n||2===arguments.length)for(var r,a=0,o=t.length;a<o;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))}([],i(e)).filter(function(e){return void 0!==e})):e;if(!(null==t?void 0:t.removeUndefinedValues)&&n.has(void 0))throw new Error("Pass options.removeUndefinedValues=true to remove undefined values from map/array/set.");if(0===n.size){if(null==t?void 0:t.convertEmptyValues)return f();throw new Error("Pass a non-empty set, or options.convertEmptyValues=true.")}var r=n.values().next().value;if("number"==typeof r)return{NS:Array.from(n).map(v).map(function(e){return e.N})};if("bigint"==typeof r)return{NS:Array.from(n).map(p).map(function(e){return e.N})};if("string"==typeof r)return{SS:Array.from(n).map(g).map(function(e){return e.S})};if(y(r))return{BS:Array.from(n).map(d).map(function(e){return e.B})};throw new Error("Only Number Set (NS), Binary Set (BS) or String Set (SS) are allowed.")},c=function(e,t){return{M:function(e){var n,r,a={};try{for(var u=o(e),l=u.next();!l.done;l=u.next()){var c=i(l.value,2),m=c[1];"function"==typeof m||void 0===m&&(null==t?void 0:t.removeUndefinedValues)||(a[c[0]]=s(m,t))}}catch(f){n={error:f}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}return a}(e)}},m=function(e,t){return{M:function(e){var n={};for(var r in e){var a=e[r];"function"==typeof a||void 0===a&&(null==t?void 0:t.removeUndefinedValues)||(n[r]=s(a,t))}return n}(e)}},f=function(){return{NULL:!0}},d=function(e){return{B:e}},g=function(e){return{S:e.toString()}},p=function(e){return{N:e.toString()}},h=function(e){throw new Error(e+" "+("function"==typeof BigInt?"Use BigInt.":"Pass string value instead.")+" ")},v=function(e){if([Number.NaN,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY].map(function(e){return e.toString()}).includes(e.toString()))throw new Error("Special numeric value "+e.toString()+" is not allowed");return e>Number.MAX_SAFE_INTEGER?h("Number "+e.toString()+" is greater than Number.MAX_SAFE_INTEGER."):e<Number.MIN_SAFE_INTEGER&&h("Number "+e.toString()+" is lesser than Number.MIN_SAFE_INTEGER."),{N:e.toString()}},y=function(e){return!!(null==e?void 0:e.constructor)&&["ArrayBuffer","Blob","Buffer","DataView","File","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"].includes(e.constructor.name)},w=function(e,t){var n,r;try{for(var a=o(Object.entries(e)),s=a.next();!s.done;s=a.next()){var u=i(s.value,2),l=u[0],c=u[1];if(void 0!==c)switch(l){case"NULL":return null;case"BOOL":return Boolean(c);case"N":return S(c,t);case"B":return b(c);case"S":return N(c);case"L":return E(c,t);case"M":return P(c,t);case"NS":return new Set(c.map(function(e){return S(e,t)}));case"BS":return new Set(c.map(b));case"SS":return new Set(c.map(N));default:throw new Error("Unsupported type passed: "+l)}}}catch(m){n={error:m}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}throw new Error("No value defined: "+JSON.stringify(e))},S=function(e,t){if(null==t?void 0:t.wrapNumbers)return{value:e};var n=Number(e);if((n>Number.MAX_SAFE_INTEGER||n<Number.MIN_SAFE_INTEGER)&&![Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY].includes(n)){if("function"!=typeof BigInt)throw new Error(e+" is outside SAFE_INTEGER bounds. Set options.wrapNumbers to get string value.");try{return BigInt(e)}catch(r){throw new Error(e+" can't be converted to BigInt. Set options.wrapNumbers to get string value.")}}return n},N=function(e){return e},b=function(e){return e},E=function(e,t){return e.map(function(e){return w(e,t)})},P=function(e,t){return Object.entries(e).reduce(function(e,n){var r,o=i(n,2),s=o[0],u=o[1];return a(a({},e),((r={})[s]=w(u,t),r))},{})},I=n("fXoL"),T=n("e8h1"),M=n("tk/3");let A=(()=>{class e{constructor(e,t){this.storage=e,this.httpSvc=t,this.gameResults=[],this.getOpponents=e=>[...new Set(e.map(e=>e.opponents).reduce((e,t)=>[...e,...t],[]))].sort().map(e=>({name:e,checked:!1})),this.saveGame=e=>{const t=s({pk:this.currentEmail,sk:`tca-uno#${e.endDateTime}`,ts:e.endDateTime,user:this.currentEmail,app:"tca-uno",gsi1pk:"tca-uno",gsi1sk:e.endDateTime,game:e},{removeUndefinedValues:!0,convertClassInstanceToMap:!0}).M;console.log(t),this.httpSvc.post("https://32wop75hhc.execute-api.us-east-1.amazonaws.com/prod/data",{TableName:"tca-data",Item:t}).subscribe()},this.loadGames=e=>{console.log(e);const t=`https://32wop75hhc.execute-api.us-east-1.amazonaws.com/prod/data/?user=${null==e?void 0:e.email}&game=tca-uno`;return console.log(t),this.httpSvc.get(t).toPromise()},this.saveEmailAndNickname=(e,t)=>Object(r.a)(this,void 0,void 0,function*(){yield this.storage.ready(),console.log({email:e,nickname:t}),this.storage.set("tcaUnoEmailAndNickname",JSON.stringify({email:e,nickname:t}))}),this.loadEmailAndNickname=()=>Object(r.a)(this,void 0,void 0,function*(){return yield this.storage.ready(),yield this.storage.get("tcaUnoEmailAndNickname")}),this.currentEmail="unknown"}loadPreviousGameResults(){return Object(r.a)(this,void 0,void 0,function*(){yield this.storage.ready();const e=yield this.storage.get("tcaUnoEmailAndNickname");console.log(e);const t=yield this.loadGames(JSON.parse(e));console.log(t);const n=t.Items.map(e=>w({M:e},void 0));this.gameResults=n.map(e=>e.game),console.log("loadPreviousGameResults()",this.gameResults)})}getResultsInReverseChron(){return[...this.gameResults.sort((e,t)=>e.endDateTime>=t.endDateTime?-1:1)]}confirmGameEnd(e,t,n,r){let a;switch(e){case"Win":a={startDateTime:this.currentGameStartDateTime,endDateTime:(new Date).toISOString(),opponents:this.currentGameOpponents,actions:t,winningPlayer:"Me",firstCardPlayedBy:n};break;case"Lose":a={startDateTime:this.currentGameStartDateTime,endDateTime:(new Date).toISOString(),opponents:this.currentGameOpponents,actions:t,winningPlayer:r,firstCardPlayedBy:n};break;case"Quit":a={startDateTime:this.currentGameStartDateTime,endDateTime:(new Date).toISOString(),opponents:this.currentGameOpponents,actions:t,winningPlayer:"None",firstCardPlayedBy:n}}this.gameResults=[...this.gameResults,a],this.saveGame(a),console.log("confirmGameEnd()",this.gameResults)}updateWithPastedGameResults(e){this.gameResults=e}calculateBasicWinLossStats(){const e=this.gameResults.filter(e=>"Me"==e.winningPlayer).length,t=this.gameResults.filter(e=>"Me"!=e.winningPlayer&&"None"!=e.winningPlayer).length,n=this.gameResults.length,r=n-(e+t);return{numberOfGames:this.gameResults.length,wins:e,losses:t,winningPercent:e/(e+t),quits:r,completionPercent:(n-r)/n}}calculateHandSizeFacts(){const e=this.gameResults.map(e=>({win:"Me"==e.winningPlayer,actions:e.actions.reduce((e,t)=>[...e,e[e.length-1]+t.cardDelta],[7])})),t=Math.max(...e.reduce((e,t)=>[...e,...t.actions],[])),n=Math.max(...e.filter(e=>e.win).reduce((e,t)=>[...e,...t.actions],[]));return console.log(e),{largestHand:isFinite(t)?t:0,largestHandWithWin:isFinite(n)?n:0}}calculateLeaderboard(){const e=this.gameResults.map(e=>Object.assign(Object.assign({},e),{players:["Me",...e.opponents]})).reduce((e,t)=>(t.players.forEach(n=>e.set(n,[...e.get(n)||[],t])),e),new Map);console.log([...e]);const t=[...e].map(e=>{const t=e[1].filter(t=>t.winningPlayer==e[0]).length,n=e[1].filter(t=>t.winningPlayer!=e[0]&&"None"!=t.winningPlayer).length;return{name:e[0],wins:t,losses:n,winningPercent:t/(t+n)||0}}).sort((e,t)=>e.winningPercent>t.winningPercent?-1:1);return console.log(t),t}timeConversion(e){const t=[],n=36e5,r=Math.trunc(e/n);r>0&&(t.push(r+"h"),e-=r*n);const a=Math.trunc(e/6e4);a>0&&(t.push(a+"m"),e-=6e4*a);const o=Math.trunc(e/1e3);return o>0&&t.push(o+"s"),t.join(" ")}calculateGameTimeFacts(){const e=this.gameResults.map(e=>Date.parse(e.endDateTime)-Date.parse(e.startDateTime));return console.log(e),{longest:e.length>0?this.timeConversion(Math.max(...e)):"n/a",shortest:e.length>0?this.timeConversion(Math.min(...e)):"n/a"}}calculateTotalUnoTime(){var e;const t=this.gameResults.map(e=>Date.parse(e.endDateTime)-Date.parse(e.startDateTime)),n=t.reduce((e,t)=>e+t,1e3);return console.log({gameDurations:t,time:n}),null!==(e=this.timeConversion(n))&&void 0!==e?e:"n/a"}calculateGameTurnFacts(){const e=this.gameResults.map(e=>e.actions.length),t=this.gameResults.filter(e=>"Me"==e.winningPlayer).map(e=>e.actions.length),n=this.gameResults.filter(e=>"Me"!=e.winningPlayer&&"None"!=e.winningPlayer).map(e=>e.actions.length);return{mostTurns:e.length>0?Math.max(...e).toString():"n/a",fewestTurns:e.length>0?Math.min(...e).toString():"n/a",quickestWin:t.length>0?Math.min(...t).toString():"n/a",quickestLoss:n.length>0?Math.min(...n).toString():"n/a"}}calculateGameSizeStats(){const e=this.gameResults.reduce((e,t)=>e.set(t.opponents.length+1,[...e.get(t.opponents.length+1)||[],t]),new Map);console.log([...e]);const t=[...e].map(e=>{const t=e[1].filter(e=>"Me"==e.winningPlayer).length,n=e[1].filter(e=>"Me"!=e.winningPlayer&&"None"!=e.winningPlayer).length;return{numberOfPlayers:e[0],wins:t,losses:n,winningPercent:t/(t+n)||0}}).sort((e,t)=>e.numberOfPlayers>t.numberOfPlayers?1:-1);return console.log(t),t}calculateFirstCardStats(){const e=this.gameResults.filter(e=>e.firstCardPlayedBy&&e.firstCardPlayedBy.length>0&&"None"!=e.winningPlayer);return console.log("calculateFirstCardStats",e),{winningPercent:e.filter(e=>e.firstCardPlayedBy==e.winningPlayer).length/e.length,numberOfGames:e.length}}getPreviousOpponents(){return this.getOpponents(this.gameResults)}clearData(){}}return e.\u0275fac=function(t){return new(t||e)(I.Qb(T.b),I.Qb(M.a))},e.\u0275prov=I.Fb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},mrSG:function(e,t,n){"use strict";function r(e,t,n,r){return new(n||(n=Promise))(function(a,o){function i(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}u((r=r.apply(e,t||[])).next())})}n.d(t,"a",function(){return r})}}]);